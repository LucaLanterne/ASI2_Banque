<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Gestion bancaire</title>

    <!-- Inclusion Bootstrap pour le style et layout responsive -->
    <link crossorigin="anonymous"
          href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
          rel="stylesheet">

    <!-- Inclusion jQuery et jQuery UI pour l'autocomplétion -->
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <!-- Script pour autocomplétion du numéro de compte -->
    <script type="text/javascript">
        $(function(){
            $("#numeroCompteAutocomplete").autocomplete({
                source: "/operation/listeNumeroCompteAutocomplete", // URL de la source de données
                minLength:2 // Lancement de l'autocomplete après 2 caractères
            });
        });
    </script>
</head>
<body>

<!-- Insertion de la barre de menu depuis le fragment commun -->
<div th:insert="~{Common/menu_bar :: menubar}"></div>

<div class="container container-md">

    <!-- Titre principal -->
    <div class="row pt-3">
        <h1 class="text-center">Gestion des opérations</h1>
    </div>

    <!-- Affichage du numéro de compte si un compte est sélectionné -->
    <div class="row pb-3">
        <h1>du compte :</h1>
        <h1 class="text-center" th:if="${produitBancaire!=null && produitBancaire.id != null}"
            th:text="${produitBancaire.numeroCompte}"></h1>
    </div>

    <!-- Section du formulaire pour charger les opérations d’un compte -->
    <div class="row border bg-light">

        <!-- Formulaire avec autocomplétion -->
        <form th:action="@{/operation/loadOperationAutocomplete}" method="POST">
            <div class="form-group m-2">
                <label>Numéro de compte</label>
                <div class="input-group">
                    <input type="text"
                           class="form-control"
                           id="numeroCompteAutocomplete"
                           name="numeroCompteAutocomplete"
                           placeholder="Saisir le numéro du compte"/>
                </div>
                <div class="form-group m-2">
                    <button type="submit" class="btn btn-primary btn-sm mb-3">
                        Charger les opérations du compte
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Affichage du tableau des opérations uniquement si un compte est chargé -->
    <div th:if="${produitBancaire!=null && produitBancaire.id!=null}">
        <div class="row mt-3">
            <!-- Bouton pour ajouter une nouvelle opération -->
            <a th:href="@{/operation/edit}" class="btn btn-primary btn-sm mb-3">Ajouter une opération</a>
        </div>

        <!-- Tableau des opérations -->
        <div class="row">
            <table class="table table-striped table-bordered">
                <thead class="thead-dark">
                <tr>
                    <th>Date opération</th>
                    <th>Libellé opération</th>
                    <th>Montant opération</th>
                    <th>Type opération</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <!-- Boucle Thymeleaf sur la liste des opérations -->
                <tr th:each="op : ${listeOperations}">
                    <td th:text="${#dates.format(op.dateOperation, 'dd/MM/yyyy')}"></td> <!-- Format de date -->
                    <td th:text="${op.getLibelle()}"></td>
                    <td th:text="${op.getMontant()}"></td>
                    <td th:text="${op.getType()}"></td>
                    <td>
                        <!-- Actions pour chaque opération -->
                        <a th:href="@{/operation/details/{id}(id=${op.id})}" class="btn btn-primary">Détails</a>
                        <a th:href="@{/operation/edit/{id}(id=${op.id})}" class="btn btn-primary">Modifier</a>
                        <a class="btn btn-danger btn-sm"
                           th:href="@{/operation/delete/{id}(id=${op.id})}"
                           onclick="return confirm('Confirmer la suppression ?');">Supprimer</a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>
</body>
</html>
