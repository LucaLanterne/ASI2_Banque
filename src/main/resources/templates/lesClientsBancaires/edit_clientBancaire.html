<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Édition client bancaire</title>

    <!-- Bootstrap CSS pour le style et la mise en page -->
    <link crossorigin="anonymous"
          href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
          rel="stylesheet">
</head>
<body>

<!-- Inclusion du menu global -->
<div th:insert="~{Common/menu_bar :: menubar}"></div>

<div class="container">
    <div class="row">
        <!-- Card centrée pour le formulaire -->
        <div class="col-lg-8 offset-lg-2 card mt-4">

            <!-- Titre conditionnel : modification ou création -->
            <h1 class="text-center" th:if="${clientBancaire.id != null}">
                Modification d’un client bancaire
            </h1>
            <h1 class="text-center" th:unless="${clientBancaire.id != null}">
                Création d’un client bancaire
            </h1>

            <div class="card-body">

                <!-- Formulaire Thymeleaf lié à l'objet clientBancaire -->
                <form th:action="@{/clientBancaire/save/}"
                      th:object="${clientBancaire}"
                      method="POST">

                    <!-- Sélection des personnes (multi-select) -->
                    <div class="form-group">
                        <label for="select_personnes">Sélectionner des personnes</label>
                        <select multiple
                                class="form-control"
                                id="select_personnes"
                                name="personnesIds"
                                required>
                            <!-- Parcours de la liste des personnes disponibles -->
                            <option th:each="p : ${listePersonnes}"
                                    th:value="${p.id}"
                                    th:selected="${clientBancaire.personnes.contains(p)}"
                                    th:text="${p.nomComplet()}">
                            </option>
                        </select>
                        <small class="form-text text-muted">
                            Maintenez CTRL (ou CMD sur Mac) pour sélectionner plusieurs personnes.
                        </small>
                    </div>

                    <!-- Liste des produits bancaires existants (lecture seule) -->
                    <div class="form-group" th:if="${clientBancaire.id != null}">
                        <label>Produits bancaires associés</label>
                        <ul>
                            <li th:each="pb : ${clientBancaire.produitBancaires}"
                                th:text="${pb.numeroCompte} + ' (' + ${pb.typeProduit.intitule} + ')'">
                            </li>
                        </ul>
                        <small class="form-text text-muted">
                            Les produits bancaires se gèrent depuis leur propre section.
                        </small>
                    </div>

                    <!-- Boutons d'action -->
                    <div class="box-footer">
                        <!-- Champ caché pour l'ID (utile pour la modification) -->
                        <input type="hidden" th:field="*{id}" id="id"/>

                        <!-- Bouton pour enregistrer le client -->
                        <button type="submit" class="btn btn-primary">Enregistrer</button>

                        <!-- Bouton pour annuler et revenir à la liste -->
                        <a th:href="@{/clientBancaire}" class="btn btn-secondary">Annuler</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</body>
</html>
